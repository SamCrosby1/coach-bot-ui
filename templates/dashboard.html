{% extends "layout.html" %}
{% block title %}Dashboard â€” Coach Onboarding Tool{% endblock %}

{% block content %}
  <h1 class="text-2xl font-semibold text-primary mb-6">Global Opens Heatmap</h1>
  <div class="bg-white p-6 rounded-2xl shadow-lg">
    <div id="globe" class="w-full h-96"></div>
  </div>

  <!-- three.js + three-globe -->
  <script src="https://unpkg.com/three@0.152.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three-globe@2.24.9/build/three-globe.min.js"></script>
  <script>
    // Only coaches with open_count >=1
    const data = {{ coaches|selectattr("open_count", "gt", 0)|list|tojson }};

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize( window.innerWidth*0.8, window.innerHeight*0.5 );
    document.getElementById('globe').appendChild(renderer.domElement);

    const scene  = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera();
    camera.aspect = (window.innerWidth*0.8)/(window.innerHeight*0.5);
    camera.updateProjectionMatrix();
    camera.position.z = 300;

    const globe = new ThreeGlobe()
      .pointsData(data)
      .pointLat('lat')
      .pointLng('lng')
      .pointColor(()=>'rgba(29,140,248,0.8)')
      .pointAltitude(0.01)
      .pointRadius(1.5);

    scene.add(new THREE.AmbientLight(0xffffff));
    scene.add(globe);

    (function animate() {
      globe.rotation.y += 0.002;
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    })();
  </script>
{% endblock %}
